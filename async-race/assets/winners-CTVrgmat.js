var v=Object.defineProperty;var C=(d,e,n)=>e in d?v(d,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):d[e]=n;var i=(d,e,n)=>(C(d,typeof e!="symbol"?e+"":e,n),n);import{S as b,W as l,C as x}from"./svgComponent-CP56xqQC.js";import{B as g,c as s,S as r,O as p,s as _,a as N}from"./index-9POz6T_7.js";const T="winner",H="winner_head",P="winner_head",W="winner-wins",y="winner-time",B="winner-image",I="winner-id",S="winner-name",w={winner:T,winner_head:H,winnerHead:P,"winner-wins":"winner-wins",winnerWins:W,"winner-time":"winner-time",winnerTime:y,"winner-image":"winner-image",winnerImage:B,"winner-id":"winner-id",winnerId:I,"winner-name":"winner-name",winnerName:S};class L extends g{constructor(n,t,o){super("div",["winners-row"]);i(this,"name");i(this,"color");i(this,"time");i(this,"index");i(this,"id");i(this,"wins");this.name=t.name,this.color=t.color,this.wins=n.wins,this.time=n.time,this.id=n.id,this.index=o,this.createContent()}createContent(){const n=s("div",[w.winnerId],void 0,[{innerText:`${this.index}`}]),t=new b(this.color,this.id),o=s("div",[w.winnerImage],void 0,void 0,[t.getNode()]),c=s("div",[w.winnerName],void 0,[{innerText:this.name}]),h=s("div",[w.winnerWins],void 0,[{innerText:`${this.wins}`}]),u=s("div",[w.winnerTime],void 0,[{innerText:`${this.time}`}]);this.appendChildren([n,o,c,h,u])}}const f="winners",A="winners-row",O="winners-row_head",k="winners-column",$="winners-column_sorted_asc",E="winners-column_sorted_desc",R="winners-content",D="order-icon",a={winners:f,"winners-row":"winners-row",winnersRow:A,"winners-row_head":"winners-row_head",winnersRowHead:O,"winners-column":"winners-column",winnersColumn:k,"winners-column_sorted_asc":"winners-column_sorted_asc",winnersColumnSortedAsc:$,"winners-column_sorted_desc":"winners-column_sorted_desc",winnersColumnSortedDesc:E,"winners-content":"winners-content",winnersContent:R,"order-icon":"order-icon",orderIcon:D},m={1:"â„–",2:"Car",3:"Name",4:"Winnings",5:"Best time (s)"};class M extends g{constructor(){super("div",[a.winners]);i(this,"winnersBlock");i(this,"timeHead");i(this,"winsHead");i(this,"winsOrderIcon");i(this,"timeOrderIcon");i(this,"pgnNext");i(this,"pgnText");i(this,"pgnPrevious");i(this,"total")}createTableHead(){const n=s("div",[a.winnersRow,"winners-row_head"]);Object.values(m).forEach(t=>{if(t===m[4])this.winsOrderIcon=s("span",[a.orderIcon]),this.winsHead=s("div",[a.winnersColumn],void 0,[{innerText:t}],[this.winsOrderIcon]),n.append(this.winsHead);else if(t===m[5])this.timeOrderIcon=s("span",[a.orderIcon]),this.timeHead=s("div",[a.winnersColumn,"winners-column_sorted_asc"],void 0,[{innerText:t}],[this.timeOrderIcon]),n.append(this.timeHead);else{const o=s("div",[a.winnersColumn],void 0,[{innerText:t}]);n.append(o)}}),this.appendChildren([n])}renderPagination(){this.pgnNext=s("button",["btn","pgn-button","pgn-button_next"],{type:"button"},void 0,[s("span",["pgn-icon"])]),this.pgnPrevious=s("button",["btn","pgn-button","pgn-button_previous"],{type:"button"},void 0,[s("span",["pgn-icon"])]),this.pgnText=s("p",["pgn-text"]),this.total=s("h4",["pgn-total"]);const n=s("div",["pgn-container"],void 0,void 0,[this.pgnPrevious,this.pgnText,this.pgnNext,this.total]);this.appendChildren([n])}setPagination(n,t){this.pgnNext.removeAttribute("disabled"),this.pgnPrevious.removeAttribute("disabled");const o=Math.ceil(t/10)===0?1:Math.ceil(t/10);this.pgnText.innerText=`${n} / ${o}`,this.total.innerText=`Winners total: ${t}`,n===1&&this.pgnPrevious.setAttribute("disabled","disabled"),n===o&&this.pgnNext.setAttribute("disabled","disabled")}createWinnersContainer(){this.winnersBlock=s("div",[a.winnersContent]),this.appendChildren([this.winnersBlock])}cleanWinnersContainer(){this.winnersBlock.replaceChildren()}setSortingColumns(n,t){this.winsHead.className=a.winnersColumn,this.timeHead.className=a.winnersColumn,n===r.time?this.timeHead.classList.add(`winners-column_sorted_${t.toLowerCase()}`):this.winsHead.classList.add(`winners-column_sorted_${t.toLowerCase()}`)}}class q{constructor(){i(this,"view");i(this,"pageNumber");i(this,"sortBy",r.time);i(this,"order",p.ASC);this.view=new M,this.pageNumber=1,this.renderStaticParts()}renderStaticParts(){this.view.createTableHead(),this.view.createWinnersContainer(),this.view.renderPagination(),this.bindPaginationListeners(),this.bindSortingListeners()}bindPaginationListeners(){this.view.pgnNext.addEventListener("click",()=>this.handlePagination(1)),this.view.pgnPrevious.addEventListener("click",()=>this.handlePagination(-1))}bindSortingListeners(){this.view.winsHead.addEventListener("click",()=>this.handleSorting(r.wins)),this.view.timeHead.addEventListener("click",()=>this.handleSorting(r.time))}async loadPage(){const e=await l.getWinners(this.pageNumber,this.sortBy,this.order);this.view.setPagination(this.pageNumber,l.winnersTotal),this.renderWinners(e)}async renderWinners(e){this.view.cleanWinnersContainer(),e.forEach(async(n,t)=>{const o=(this.pageNumber-1)*10+t+1,c=await x.getCar(n.id),h=new L(n,c,o);this.view.winnersBlock.append(h.getNode())})}handlePagination(e){this.pageNumber+=e,this.loadPage()}async handleSorting(e){this.sortBy===r.wins&&e===r.wins||this.sortBy===r.time&&e===r.time?this.order=_(this.order):(this.sortBy===r.time&&e===r.wins||this.sortBy===r.wins&&e===r.time)&&(this.sortBy=N(this.sortBy),this.order=p.ASC),this.view.setSortingColumns(this.sortBy,this.order),await this.loadPage()}}export{q as Winners};
