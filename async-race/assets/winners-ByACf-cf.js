var C=Object.defineProperty;var b=(d,e,n)=>e in d?C(d,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):d[e]=n;var t=(d,e,n)=>(b(d,typeof e!="symbol"?e+"":e,n),n);import{S as x,W as p,C as _}from"./svgComponent-CWLWJl9k.js";import{B as u,c as s,S as r,O as h,s as g}from"./index-vCWIRAhW.js";const y="winner",N="winner_head",P="winner_head",W="winner-wins",B="winner-time",T="winner-image",H="winner-id",I="winner-name",w={winner:y,winner_head:N,winnerHead:P,"winner-wins":"winner-wins",winnerWins:W,"winner-time":"winner-time",winnerTime:B,"winner-image":"winner-image",winnerImage:T,"winner-id":"winner-id",winnerId:H,"winner-name":"winner-name",winnerName:I};class S extends u{constructor(n,i,o){super("div",["winners-row"]);t(this,"name");t(this,"color");t(this,"time");t(this,"index");t(this,"id");t(this,"wins");this.name=i.name,this.color=i.color,this.wins=n.wins,this.time=n.time,this.id=n.id,this.index=o,this.createContent()}createContent(){const n=s("div",[w.winnerId],void 0,[{innerText:`${this.index}`}]),i=new x(this.color,this.id),o=s("div",[w.winnerImage],void 0,void 0,[i.getNode()]),c=s("div",[w.winnerName],void 0,[{innerText:this.name}]),l=s("div",[w.winnerWins],void 0,[{innerText:`${this.wins}`}]),v=s("div",[w.winnerTime],void 0,[{innerText:`${this.time}`}]);this.appendChildren([n,o,c,l,v])}}const f="winners",L="winners-row",O="winners-row_head",A="winners-column",k="winners-column_sorted_asc",$="winners-column_sorted_desc",E="winners-content",R="order-icon",a={winners:f,"winners-row":"winners-row",winnersRow:L,"winners-row_head":"winners-row_head",winnersRowHead:O,"winners-column":"winners-column",winnersColumn:A,"winners-column_sorted_asc":"winners-column_sorted_asc",winnersColumnSortedAsc:k,"winners-column_sorted_desc":"winners-column_sorted_desc",winnersColumnSortedDesc:$,"winners-content":"winners-content",winnersContent:E,"order-icon":"order-icon",orderIcon:R},m={1:"â„–",2:"Car",3:"Name",4:"Winnings",5:"Best time (s)"};class D extends u{constructor(){super("div",[a.winners]);t(this,"winnersBlock");t(this,"timeHead");t(this,"winsHead");t(this,"winsOrderIcon");t(this,"timeOrderIcon");t(this,"pgnNext");t(this,"pgnText");t(this,"pgnPrevious");t(this,"total")}createTableHead(){const n=s("div",[a.winnersRow,"winners-row_head"]);Object.values(m).forEach(i=>{if(i===m[4])this.winsOrderIcon=s("span",[a.orderIcon]),this.winsHead=s("div",[a.winnersColumn],void 0,[{innerText:i}],[this.winsOrderIcon]),n.append(this.winsHead);else if(i===m[5])this.timeOrderIcon=s("span",[a.orderIcon]),this.timeHead=s("div",[a.winnersColumn,"winners-column_sorted_asc"],void 0,[{innerText:i}],[this.timeOrderIcon]),n.append(this.timeHead);else{const o=s("div",[a.winnersColumn],void 0,[{innerText:i}]);n.append(o)}}),this.appendChildren([n])}renderPagination(){this.pgnNext=s("button",["btn","pgn-button","pgn-button_next"],{type:"button"},void 0,[s("span",["pgn-icon"])]),this.pgnPrevious=s("button",["btn","pgn-button","pgn-button_previous"],{type:"button"},void 0,[s("span",["pgn-icon"])]),this.pgnText=s("p",["pgn-text"]),this.total=s("h4",["pgn-total"]);const n=s("div",["pgn-container"],void 0,void 0,[this.pgnPrevious,this.pgnText,this.pgnNext,this.total]);this.appendChildren([n])}setPagination(n,i){this.pgnNext.removeAttribute("disabled"),this.pgnPrevious.removeAttribute("disabled");const o=Math.ceil(i/10)===0?1:Math.ceil(i/10);this.pgnText.innerText=`${n} / ${o}`,this.total.innerText=`Winners total: ${i}`,n===1&&this.pgnPrevious.setAttribute("disabled","disabled"),n===o&&this.pgnNext.setAttribute("disabled","disabled")}createWinnersContainer(){this.winnersBlock=s("div",[a.winnersContent]),this.appendChildren([this.winnersBlock])}cleanWinnersContainer(){this.winnersBlock.replaceChildren()}setSortingColumns(n,i){this.winsHead.className=a.winnersColumn,this.timeHead.className=a.winnersColumn,n===r.time?this.timeHead.classList.add(`winners-column_sorted_${i.toLowerCase()}`):this.winsHead.classList.add(`winners-column_sorted_${i.toLowerCase()}`)}}class G{constructor(){t(this,"view");t(this,"pageNumber");t(this,"sortBy",r.time);t(this,"order",h.ASC);this.view=new D,this.pageNumber=1,this.renderStaticParts()}renderStaticParts(){this.view.createTableHead(),this.view.createWinnersContainer(),this.view.renderPagination(),this.bindPaginationListeners(),this.bindSortingListeners()}bindPaginationListeners(){this.view.pgnNext.addEventListener("click",()=>this.handlePagination(1)),this.view.pgnPrevious.addEventListener("click",()=>this.handlePagination(-1))}bindSortingListeners(){this.view.winsHead.addEventListener("click",()=>this.handleSorting(r.wins)),this.view.timeHead.addEventListener("click",()=>this.handleSorting(r.time))}async loadPage(){const e=await p.getWinners(this.pageNumber,this.sortBy,this.order);this.view.setPagination(this.pageNumber,p.winnersTotal),this.renderWinners(e)}async renderWinners(e){this.view.cleanWinnersContainer();const n=e.map(async(o,c)=>await this.renderOneWinner(o,c));(await Promise.all(n)).forEach(o=>this.view.winnersBlock.append(o.getNode()))}async renderOneWinner(e,n){const i=(this.pageNumber-1)*10+n+1,o=await _.getCar(e.id);return new S(e,o,i)}handlePagination(e){this.pageNumber+=e,this.loadPage()}async handleSorting(e){this.sortBy===r.wins&&e===r.wins?(this.sortBy=r.wins,this.order=g(this.order)):this.sortBy===r.time&&e===r.time?(this.sortBy=r.time,this.order=g(this.order)):this.sortBy===r.time&&e===r.wins?(this.sortBy=r.wins,this.order=h.ASC):this.sortBy===r.wins&&e===r.time&&(this.sortBy=r.time,this.order=h.ASC),this.view.setSortingColumns(this.sortBy,this.order),await this.loadPage()}}export{G as Winners};
